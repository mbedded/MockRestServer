<html>
<head>
    <link rel="stylesheet" type="text/css" href="/assets/style.css">
    <script src="/assets/jquery-3.5.1.min.js" type="text/javascript"></script>
    <script src="/assets/notify.js" type="text/javascript"></script>
</head>
<body>
<h1>Create new Mock</h1>

<form>
    <label for="txtKey">Key</label>

    <br>
    <input id="txtKey" type="text" placeholder="Your custom name for this mock (optional)"
           style="width: 500px;" autofocus>

    <br>
    <label for="txtContent">Content</label>

    <br>
    <textarea id="txtContent" style="width: 500px;" rows="40"></textarea>

    <br>
    <button id="btnSubmit" type="button">Save</button>
</form>

<a href="/">Cancel</a>

<script>
    $(function () {
        let txtKey = $("#txtKey");
        let txtContent = $("#txtContent");
        let saveMethod = "POST";

        let searchParams = new URLSearchParams(window.location.search);
        let key = searchParams.get('key');

        if (!!key) {
            $.ajax({
                url: `/api/mock/${key}`,
                success: function (data) {
                    saveMethod = "PUT";
                    let jObject = JSON.parse(data);

                    txtKey.val(jObject.Key);
                    txtContent.val(jObject.Content);
                }
            });
        }

        $("#btnSubmit").on("click", function () {
            $.ajax({
                type: saveMethod,
                url: '/api/mock',
                data: JSON.stringify({
                    "Key": txtKey.val(),
                    "Content": txtContent.val()
                }),
                success: function (data) {
                    const result = JSON.parse(data);
                    $.notify(`Mock '${result.Key}' saved.`, "success");

                    if (saveMethod === "POST") {
                        txtKey.val("");
                        txtContent.val("");
                        txtKey.focus();
                    }
                },
                error: function (errMsg) {
                    $.notify(`Error saving mock.\r\n${errMsg.responseText}`, "error");
                }
            })
        });
    });
</script>
</body>
</html>
